"use strict";var FraudDetectorLib=(()=>{var w=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames,D=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var T=(t,e,o)=>e in t?w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,y=(t,e)=>{for(var o in e||(e={}))E.call(e,o)&&T(t,o,e[o]);if(D)for(var o of D(e))A.call(e,o)&&T(t,o,e[o]);return t};var F=(t,e)=>{for(var o in e)w(t,o,{get:e[o],enumerable:!0})},C=(t,e,o,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of k(e))!E.call(t,s)&&s!==o&&w(t,s,{get:()=>e[s],enumerable:!(i=P(e,s))||i.enumerable});return t};var M=t=>C(w({},"__esModule",{value:!0}),t);var h=(t,e,o)=>new Promise((i,s)=>{var n=r=>{try{l(o.next(r))}catch(g){s(g)}},c=r=>{try{l(o.throw(r))}catch(g){s(g)}},l=r=>r.done?i(r.value):Promise.resolve(r.value).then(n,c);l((o=o.apply(t,e)).next())});var _={};F(_,{FraudDetector:()=>f,default:()=>N});function I(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function S(t){return h(this,null,function*(){let o=new TextEncoder().encode(t),i=yield crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(i)).map(n=>n.toString(16).padStart(2,"0")).join("")})}function R(){let t=navigator.userAgent,e=navigator.platform,i=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t),n=/iPad|Android(?=.*\b(tablet|pad)\b)|tablet/i.test(t)||t.includes("Android")&&!t.includes("Mobile"),l=["Win32","Win64","Windows","MacIntel","Mac68K","Linux x86_64","Linux i686"].some(a=>e.includes(a)),r=i&&l&&!n,g=navigator.webdriver===!0,x=/HeadlessChrome|Headless|PhantomJS|Nightmare/i.test(t),d="unknown",u="";if(t.includes("Windows NT 10"))d="Windows",u="10";else if(t.includes("Windows NT 6.3"))d="Windows",u="8.1";else if(t.includes("Windows NT 6.1"))d="Windows",u="7";else if(t.includes("Mac OS X")){d="macOS";let a=t.match(/Mac OS X (\d+[._]\d+)/);u=a?a[1].replace("_","."):""}else if(t.includes("Android")){d="Android";let a=t.match(/Android (\d+\.?\d*)/);u=a?a[1]:""}else if(t.includes("iPhone")||t.includes("iPad")){d=t.includes("iPad")?"iPadOS":"iOS";let a=t.match(/OS (\d+[._]\d+)/);u=a?a[1].replace("_","."):""}else t.includes("Linux")&&(d="Linux");let p="unknown",v="";if(t.includes("Chrome")&&!t.includes("Edg")){p="Chrome";let a=t.match(/Chrome\/(\d+)/);v=a?a[1]:""}else if(t.includes("Firefox")){p="Firefox";let a=t.match(/Firefox\/(\d+)/);v=a?a[1]:""}else if(t.includes("Safari")&&!t.includes("Chrome")){p="Safari";let a=t.match(/Version\/(\d+)/);v=a?a[1]:""}else if(t.includes("Edg")){p="Edge";let a=t.match(/Edg\/(\d+)/);v=a?a[1]:""}let m="desktop";return g||x?m="bot":n?m="tablet":i&&!r&&(m="mobile"),{type:m,isMobile:m==="mobile",isTablet:m==="tablet",isDesktop:m==="desktop",isFakeMobile:r,isAutomated:g,isHeadless:x,os:d,osVersion:u,browser:p,browserVersion:v,platform:e}}function L(){return{width:screen.width,height:screen.height,availWidth:screen.availWidth,availHeight:screen.availHeight,colorDepth:screen.colorDepth,pixelRatio:window.devicePixelRatio||1}}function B(){return{cores:navigator.hardwareConcurrency||0,memory:navigator.deviceMemory,maxTouchPoints:navigator.maxTouchPoints||0,hasTouch:"ontouchstart"in window||navigator.maxTouchPoints>0}}function W(){return h(this,null,function*(){try{let t=document.createElement("canvas");t.width=200,t.height=50;let e=t.getContext("2d");if(!e)return"canvas-unsupported";e.textBaseline="top",e.font="14px 'Arial'",e.fillStyle="#f60",e.fillRect(125,1,62,20),e.fillStyle="#069",e.fillText("FraudDetector",2,15),e.fillStyle="rgba(102, 204, 0, 0.7)",e.fillText("FraudDetector",4,17);let o=e.createLinearGradient(0,0,t.width,0);o.addColorStop(0,"red"),o.addColorStop(.5,"green"),o.addColorStop(1,"blue"),e.fillStyle=o,e.fillRect(0,30,200,10),e.beginPath(),e.arc(50,25,10,0,Math.PI*2,!0),e.closePath(),e.fill();let i=t.toDataURL();return yield S(i)}catch(t){return"canvas-error"}})}function O(){return h(this,null,function*(){try{let t=document.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl");if(!e||!(e instanceof WebGLRenderingContext))return{vendor:"unsupported",renderer:"unsupported",hash:"webgl-unsupported"};let o=e.getExtension("WEBGL_debug_renderer_info"),i="unknown",s="unknown";o&&(i=e.getParameter(o.UNMASKED_VENDOR_WEBGL)||"unknown",s=e.getParameter(o.UNMASKED_RENDERER_WEBGL)||"unknown");let n=yield S(`${i}|${s}`);return{vendor:i,renderer:s,hash:n}}catch(t){return{vendor:"error",renderer:"error",hash:"webgl-error"}}})}var b=class{constructor(e,o){this.lastMousePos=null;this.listeners=[];this.startTime=Date.now(),this.data={mouseMovements:0,mouseClicks:0,mouseDistance:0,touchEvents:0,touchTaps:0,touchSwipes:0,scrollEvents:0,scrollDistance:0,keyPresses:0,activeTime:0,totalTime:0,lastEventTime:Date.now(),sessionId:e,pageUrl:o}}start(){this.addListener("mousemove",i=>{let s=i;if(this.data.mouseMovements++,this.data.lastEventTime=Date.now(),this.lastMousePos){let n=s.clientX-this.lastMousePos.x,c=s.clientY-this.lastMousePos.y;this.data.mouseDistance+=Math.sqrt(n*n+c*c)}this.lastMousePos={x:s.clientX,y:s.clientY}}),this.addListener("click",()=>{this.data.mouseClicks++,this.data.lastEventTime=Date.now()}),this.addListener("touchstart",()=>{this.data.touchEvents++,this.data.touchTaps++,this.data.lastEventTime=Date.now()}),this.addListener("touchmove",()=>{this.data.touchEvents++,this.data.lastEventTime=Date.now()}),this.addListener("touchend",()=>{this.data.touchEvents++,this.data.lastEventTime=Date.now()});let e=0,o=window.scrollY;this.addListener("scroll",()=>{let i=Date.now();i-e>100&&(this.data.scrollEvents++,this.data.scrollDistance+=Math.abs(window.scrollY-o),o=window.scrollY,e=i,this.data.lastEventTime=i)}),this.addListener("keydown",()=>{this.data.keyPresses++,this.data.lastEventTime=Date.now()})}addListener(e,o){document.addEventListener(e,o,{passive:!0}),this.listeners.push({type:e,handler:o})}stop(){for(let{type:e,handler:o}of this.listeners)document.removeEventListener(e,o);this.listeners=[]}getData(){let e=Date.now();return this.data.totalTime=e-this.startTime,this.data.activeTime=this.data.lastEventTime-this.startTime,y({},this.data)}},f=class{constructor(e){this.behaviorTracker=null;this.stage="init";this.options={onComplete:e.onComplete,onError:e.onError||(()=>{}),onProgress:e.onProgress||(()=>{}),apiEndpoint:e.apiEndpoint||"/api/fraud-check",timeout:e.timeout||5e3,collectBehavior:e.collectBehavior!==!1,behaviorDuration:e.behaviorDuration||3e3,debug:e.debug||!1},this.sessionId=I()}analyze(){return h(this,null,function*(){try{let e=performance.now();this.setStage("fingerprinting");let o=yield this.collectFingerprint();if(o.device.isAutomated||o.device.isHeadless){let n={classification:"BAD",score:0,reason:o.device.isAutomated?"Automation detected (webdriver)":"Headless browser detected",timestamp:Date.now(),processingTime:performance.now()-e};this.setStage("complete"),this.options.onComplete(n);return}if(o.device.isFakeMobile){let n={classification:"BAD",score:0,reason:"Fake mobile device detected (emulator)",timestamp:Date.now(),processingTime:performance.now()-e};this.setStage("complete"),this.options.onComplete(n);return}let i;this.options.collectBehavior?(this.setStage("collecting_behavior"),i=yield this.collectBehavior()):i=this.getEmptyBehavior(),this.setStage("sending_request");let s=yield this.sendForClassification(o,i);s.processingTime=performance.now()-e,this.setStage("complete"),this.options.onComplete(s)}catch(e){this.setStage("error"),this.options.onError(e instanceof Error?e:new Error(String(e)));let o={classification:"WARN",score:50,reason:"Detection error - defaulting to WARN",timestamp:Date.now(),processingTime:0};this.options.onComplete(o)}})}analyzeNow(){return h(this,null,function*(){return new Promise((e,o)=>{this.options.onComplete=e,this.options.onError=o,this.options.collectBehavior=!1,this.analyze()})})}setStage(e){this.stage=e,this.options.onProgress(e),this.options.debug&&console.log(`[FraudDetector] Stage: ${e}`)}collectFingerprint(){return h(this,null,function*(){let e=R(),o=L(),i=B(),[s,n]=yield Promise.all([W(),O()]),c=[];for(let r=0;r<navigator.plugins.length;r++)c.push(navigator.plugins[r].name);let l=[];for(let r=0;r<navigator.mimeTypes.length;r++)l.push(navigator.mimeTypes[r].type);return{device:e,screen:o,hardware:i,userAgent:navigator.userAgent,language:navigator.language,languages:Array.from(navigator.languages||[navigator.language]),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timezoneOffset:new Date().getTimezoneOffset(),canvasHash:s,webglVendor:n.vendor,webglRenderer:n.renderer,webglHash:n.hash,plugins:c,mimeTypes:l,doNotTrack:navigator.doNotTrack,cookiesEnabled:navigator.cookieEnabled,collectedAt:Date.now()}})}collectBehavior(){return new Promise(e=>{this.behaviorTracker=new b(this.sessionId,window.location.href),this.behaviorTracker.start(),setTimeout(()=>{if(this.behaviorTracker){let o=this.behaviorTracker.getData();this.behaviorTracker.stop(),e(o)}},this.options.behaviorDuration)})}getEmptyBehavior(){return{mouseMovements:0,mouseClicks:0,mouseDistance:0,touchEvents:0,touchTaps:0,touchSwipes:0,scrollEvents:0,scrollDistance:0,keyPresses:0,activeTime:0,totalTime:0,lastEventTime:Date.now(),sessionId:this.sessionId,pageUrl:window.location.href}}sendForClassification(e,o){return h(this,null,function*(){let i=new AbortController,s=setTimeout(()=>i.abort(),this.options.timeout);try{let n=yield fetch(this.options.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fingerprint:e,behavior:o,timestamp:Date.now()}),signal:i.signal});if(clearTimeout(s),!n.ok)throw new Error(`API error: ${n.status}`);let c=yield n.json();if(!c.success||!c.result)throw new Error(c.error||"Unknown API error");return c.result}catch(n){throw clearTimeout(s),n}})}stopTracking(){this.behaviorTracker&&this.behaviorTracker.stop()}getStage(){return this.stage}};typeof window!="undefined"&&(window.FraudDetector=f);var N=f;return M(_);})();
if (typeof window !== "undefined") { window.FraudDetector = FraudDetectorLib.default; }
//# sourceMappingURL=fraud-detector.min.js.map
